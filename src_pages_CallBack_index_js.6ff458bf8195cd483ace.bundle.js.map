{"version":3,"file":"src_pages_CallBack_index_js.6ff458bf8195cd483ace.bundle.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;ACAA;AAEA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;ACxBA;AAEA;;;;;;;;;;;;;;;;ACFA;AAEA;AAEA;AAAA;AAGA;AAEA;;;;;;;;;;;;;;;;;;ACTA;AAEA;AAKA;AAEA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AAGA;AAEA;;;;;;;;;;;;;;;ACpDA;AAEA","sources":["webpack://@shopby/react-skin/./node_modules/@shopby/react-components/dist/esm/auth/IdentificationVerificationProvider/IdentificationVerificationProvider.js","webpack://@shopby/react-skin/./src/components/Sanitized/Sanitized.jsx","webpack://@shopby/react-skin/./src/components/Sanitized/index.js","webpack://@shopby/react-skin/./src/pages/CallBack/CallBack.jsx","webpack://@shopby/react-skin/./src/pages/CallBack/CallBackForm.jsx","webpack://@shopby/react-skin/./src/pages/CallBack/index.js"],"sourcesContent":["var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},__assign.apply(this,arguments)},__read=this&&this.__read||function(t,e){var i=\"function\"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a};import{jsx as _jsx}from\"react/jsx-runtime\";import{createContext,useContext,useMemo,useState}from\"react\";import{executeHelper,authHelper}from\"@shopby/shared/helpers\";var IdentificationVerificationStateContext=createContext(null),IdentificationVerificationActionContext=createContext(null),_a=authHelper.identificationVerification,Helper=_a.Helper,QUERY_KEY=_a.QUERY_KEY,DEFAULT_STATE={isCiExist:!1,isIdentificationVerificationReSend:!1,kcpForm:null,ci:\"\"},IdentificationVerificationProvider=function(t){var e=t.children,i=__read(useState(DEFAULT_STATE.isIdentificationVerificationReSend),2),n=i[0],r=i[1],o=__read(useState(DEFAULT_STATE.isCiExist),2),a=o[0],c=o[1],f=__read(useState(DEFAULT_STATE.kcpForm),2),s=f[0],u=f[1],_=__read(useState(DEFAULT_STATE.ci),2),d=_[0],l=_[1],E=useMemo((function(){return executeHelper(new Helper)}),[]).executeQuery,I=useMemo((function(){return{updateIsIdentificationVerificationReSend:r,updateIsCiExist:c,updateCi:l,moveIdVerification:function(t){return E(QUERY_KEY.QUERY_KCP_ID_VERIFICATION_FORM,{payload:t,onSuccess:function(t){var e=t.data;u(e)}})},getIdVerificationResponse:function(t){return E(QUERY_KEY.QUERY_KCP_ID_VERIFICATION_RESPONSE,{payload:t})},verifyCi:function(t){return E(QUERY_KEY.QUERY_PROFILE_CI_EXISTS,{payload:t})}}}),[]);return _jsx(IdentificationVerificationActionContext.Provider,__assign({value:I},{children:_jsx(IdentificationVerificationStateContext.Provider,__assign({value:{isIdentificationVerificationReSend:n,isCiExist:a,kcpForm:s,ci:d}},{children:e}))}))};export default IdentificationVerificationProvider;export var useIdentificationVerificationActionContext=function(){var t=useContext(IdentificationVerificationActionContext);if(!t)throw new Error(\"INVALID_IdentificationVerificationActionContext\");return t};export var useIdentificationVerificationStateContext=function(){var t=useContext(IdentificationVerificationStateContext);if(!t)throw new Error(\"INVALID_IdentificationVerificationStateContext\");return t};","import { string, object } from 'prop-types';\n\nconst { sanitize } = require('dompurify');\n\nconst Sanitized = ({ html, style, className = '' }) => (\n  <div\n    className={`editor ${className}`}\n    dangerouslySetInnerHTML={{\n      __html: sanitize(html ?? '', {\n        USE_PROFILES: { html: true },\n        ADD_TAGS: ['iframe', 'a'],\n        ADD_ATTR: ['allow', 'allowfullscreen', 'frameborder', 'scrolling', 'target', 'rel', 'type'],\n      }),\n    }}\n    style={style}\n  />\n);\n\nSanitized.propTypes = {\n  className: string,\n  style: object,\n  html: string,\n};\n\nexport default Sanitized;\n","import Sanitized from './Sanitized';\n\nexport default Sanitized;\n","import { IdentificationVerificationProvider } from '@shopby/react-components';\n\nimport CallBackForm from './CallBackForm';\n\nconst CallBack = () => (\n  <IdentificationVerificationProvider>\n    <CallBackForm />\n  </IdentificationVerificationProvider>\n);\nexport default CallBack;\n","import { useRef, useEffect } from 'react';\n\nimport {\n  useIdentificationVerificationActionContext,\n  useIdentificationVerificationStateContext,\n} from '@shopby/react-components';\n\nimport Sanitized from '../../components/Sanitized';\n\nconst CallBackForm = () => {\n  const { moveIdVerification } = useIdentificationVerificationActionContext();\n  const { kcpForm } = useIdentificationVerificationStateContext();\n\n  const params = new URLSearchParams(location.search);\n  const kcpKey = params.get('key');\n  const returnUrl = params.get('returnUrl');\n\n  const formRef = useRef(null);\n  const formSubmit = () => (kcpForm === null ? '' : formRef.current.querySelector('#form_auth').submit());\n\n  useEffect(() => {\n    if (kcpKey) {\n      window.parent.postMessage(kcpKey);\n    } else {\n      moveIdVerification({ returnUrl: `${location.origin}/callback?returnUrl=${returnUrl}` });\n    }\n  }, [kcpKey, returnUrl]);\n\n  useEffect(() => {\n    self.name = 'auth_popup';\n    formSubmit();\n  }, [kcpForm]);\n\n  return (\n    <>\n      <iframe\n        id=\"kcp_cert\"\n        name=\"kcp_cert\"\n        frameBorder=\"0\"\n        scrolling=\"no\"\n        style={{ display: 'none', width: '100%', height: '100%' }}\n        sandbox=\"allow-top-navigation allow-top-navigation-by-user-activation allow-popups allow-scripts allow-modals allow-forms\"\n      >\n        <div className=\"form\" ref={formRef}>\n          <Sanitized html={kcpForm} />\n        </div>\n      </iframe>\n      <div id=\"popups-area\"></div>\n    </>\n  );\n};\n\nexport default CallBackForm;\n","import CallBack from './CallBack';\n\nexport default CallBack;\n"],"names":[],"sourceRoot":""}